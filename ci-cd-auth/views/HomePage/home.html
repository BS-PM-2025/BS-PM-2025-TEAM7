<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Learn CI/CD</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: #FFFFFF;
      color: #1f2328;
      line-height: 1.5;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 16px 10%;
      background-color: #FFFFFF;
      border-bottom: 1px solid #d8dee4;
      display: flex;
      justify-content: space-between;  /* Ensures space between logo and nav links */
      align-items: center;
      z-index: 10;
    }

    .nav-links {
      list-style: none;
      display: flex;
      gap: 24px;
      margin-left: auto;  /* Pushes the nav links to the right */
    }

    .nav-links li a {
      text-decoration: none;
      color: #1f2328;
      font-weight: 500;
      font-size: 14px;
      padding: 8px 0;
      position: relative;
    }

    .nav-links li a:hover {
      color: #657EEF;
    }

    .nav-links li a.active {
      color: #657EEF;
    }

    .nav-links li a.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: #657EEF;
    }


    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-img {
      height: 32px;
      width: 32px;
    }

    .logo-text {
      font-size: 1.25rem;
      font-weight: 600;
      color: #657EEF;
    }

  .hero {
    padding: 140px 10% 80px;
    width: 90%;               /* 80% width */
    text-align: left;
    background-color: #657EEF;
    color: #FFFFFF;
    border: 2px solid #d8dee4;
    border-radius: 12px;
    margin-left: 0;  
     margin-bottom: 40px;      
  }


    .hero h1 {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 24px;
      line-height: 1.25;
    }

    .hero p {
      font-size: 20px;
      color: #FFFFFF;  /* Ensure paragraphs are white */
      max-width: 700px;
      margin-bottom: 20px;
    }


    .features-container {
      display: flex;
      justify-content: space-between;  /* Spread items across the page */
      gap: 4px;  /* Reduce the gap to make items closer */
      max-width: 80%;
      margin: 0 auto 40px;
    }

    .feature-item {
      display: flex;
      align-items: center;
      gap: 4px;  /* Reduce the gap between the text and the checkmark */
      font-size: 16px;
      font-weight: 500;
      color: #1f2328;  /* Black text color */
    }

    .feature-item::before {
      content: '✔';
      color: #4CAF50;  /* Green checkmark color */
      font-weight: bold;
    }

.role-label {
  font-size: 0.75rem;
  color: #666;
  font-weight: 400;
  margin-left: 6px;
}


    .cta-wrapper {
      display: flex;
      justify-content: center;  /* Centers horizontally */
      margin-top: 40px;  /* Optional: Add some space above the button */
    }
.cta-button {
  padding: 10px 80px;               /* Even larger padding */
  font-size: 1.6rem;                /* Bigger text */
  border-radius: 999px;             /* Fully rounded (pill shape) */
  background-color: #657EEF;        /* Adjust as needed */
  color: white;
  text-decoration: none;
  font-weight: bold;
  transition: background-color 0.3s ease;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);  /* Optional: adds depth */
}

.cta-button:hover {
  background-color: #0056b3;        /* Darker on hover */
}


.edit-btn {
  background-color: #657EEF;   /* צבע הרקע של ה-hero */
  color: #FFFFFF;              /* טקסט לבן */
  border: none;
  border-radius: 6px;
  padding: 4px 12px;
  font-size: 0.875rem;
  cursor: pointer;  
  transition: background-color 0.2s, transform 0.1s;
}
.edit-btn:hover {
  background-color: #7a88d1;   /* מעט כהה יותר בריחוף */
  transform: translateY(-1px);
}
#toggle-btn {
      margin-top: 10px;
      padding: 5px 10px;
      border: none;
      border-radius: 6px;
      background: #00ffc3;
      color: #1f4037;
      cursor: pointer;
    }
/* כפתור מחיקה – טורקיז כמו כפתור ה-Submit */
.delete-btn {
  background-color: #00ffc3;   /* צבע כפתור ה-Submit */
  color: #1f4037;             
  border: none;
  border-radius: 6px;
  padding: 4px 12px;
  font-size: 0.875rem;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}
.delete-btn:hover {
  background-color: #00e0b2;   
  transform: translateY(-1px);
}

    @media (max-width: 768px) {
      header {
        padding: 16px 5%;
        flex-direction: column;
        align-items: flex-start;
      }

      .nav-links {
        gap: 16px;
        margin-bottom: 8px;
      }

      .hero {
        padding: 120px 5% 60px;
      }

      .hero h1 {
        font-size: 36px;
      }

      .hero p {
        font-size: 18px;
      }

      .features-container {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>

<body>
  <header>
        <div class="logo-container">
      <svg class="logo-img" viewBox="0 0 24 24" fill="#657EEF" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.652.242 2.873.118 3.176.77.84 1.235 1.91 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
      </svg>
      <span class="logo-text">CI/CD</span>
          <ul class="nav-links" id="nav-links">
      <li><a href="#" class="active">Home</a></li>
      <li><a href="/signup">Sign Up</a></li>
      <li><a href="/login">Login</a></li>
    </ul>
    </div>

  </header>

    <main>
      <section class="hero">
        <h1>Learn GitHub easily</h1>
        <p>Join our interactive learning platform that explains, practices, and advances you into the real-world of software development.</p>
      </section>

      <div class="features-container">
        <div class="feature-item">Interactive Practice</div>
        <div class="feature-item">Immediate Feedback</div>
        <div class="feature-item">Clear Explanations</div>
        <div class="feature-item">Self-Paced Progress</div>
      </div>

      <!-- Centering the button -->
      <div class="cta-wrapper">
        <a href="/courses" class="cta-button">Get Started</a>
      </div>

    </main>
    
<!-- Navbar & Scripts for Token-Based Role Handling -->
<script>
  function logout() {
    sessionStorage.removeItem("token");
    window.location.href = "/login";
  }

  function parseJwt(token) {
    try {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
        '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
      return JSON.parse(jsonPayload);
    } catch (e) {
      console.error("Invalid token", e);
      return null;
    }
  }

  window.onload = () => {
    const token = sessionStorage.getItem("token");
    const navbar = document.querySelector("#nav-links");

    if (token) {
      const user = parseJwt(token);
      if (!user) return;

      // Clear out the default links
      navbar.innerHTML = "";

      if (user.role === "admin") {
        navbar.innerHTML += '<li><a href="/admin-dashboard">Admin Dashboard</a></li>';
      } 
      else if (user.role === "lecturer") {
        navbar.innerHTML += '<li><a href="/">Home</a></li>';
        navbar.innerHTML += '<li><a href="/video/courses">Courses</a></li>';
        navbar.innerHTML += '<li><a href="/LecturerProfile">Profile</a></li>';
        navbar.innerHTML += '<li><a href="/chat">Chat</a></li>';        // ← Chat for lecturers
      } 
      else if (user.role === "student") {
        navbar.innerHTML += '<li><a href="/">Home</a></li>';
        navbar.innerHTML += '<li><a href="/video/courses">Courses</a></li>';
        navbar.innerHTML += '<li><a href="/StudentProfile">Profile</a></li>';
        navbar.innerHTML += '<li><a href="/chat">Chat</a></li>';        // ← Chat for students
      }

      // Always show logout
      navbar.innerHTML += '<li><a href="#" onclick="logout()">Logout</a></li>';
    } 
    else {
      // Not logged in → show default links
      navbar.innerHTML = `
        <li><a href="/" class="active">Home</a></li>
        <li><a href="/signup">Sign Up</a></li>
        <li><a href="/login">Login</a></li>
      `;
      // Prevent back‐button to protected pages
      history.pushState(null, null, location.href);
      window.onpopstate = () => history.go(1);
    }
  };
</script>

<div class="feedback-container" id="feedback-section">
  <div class="feedback-header">
    <h2>Share Your Experience</h2>
    <p class="feedback-subtitle">We value your input to help us improve</p>
  </div>
  
  <form id="feedback-form" class="feedback-form">
    <div class="form-group">
      <label for="comment" class="form-label">Your Feedback</label>
      <textarea 
        id="comment" 
        class="form-textarea"
        placeholder="What did you think about our platform?"
        required
      ></textarea>
    </div>
    
    <div class="form-group rating-group">
      <label class="form-label">Rating</label>
      <div class="star-rating">
        <input type="radio" id="star5" name="rating" value="5" />
        <label for="star5" title="5 stars">★</label>
        <input type="radio" id="star4" name="rating" value="4" />
        <label for="star4" title="4 stars">★</label>
        <input type="radio" id="star3" name="rating" value="3" />
        <label for="star3" title="3 stars">★</label>
        <input type="radio" id="star2" name="rating" value="2" />
        <label for="star2" title="2 stars">★</label>
        <input type="radio" id="star1" name="rating" value="1" />
        <label for="star1" title="1 star">★</label>
      </div>
    </div>
    
    <button type="submit" class="submit-btn">
      Submit Feedback
    </button>
    
    <p id="feedback-message" class="feedback-message"></p>
  </form>
  
  <div class="feedback-list-container">
    <h3 class="feedback-list-title">Community Feedback</h3>
    <div id="feedback-list" class="feedback-list"></div>
  </div>
</div>

<style>
/* Feedback Section Styles */
.feedback-container {
  padding: 40px 10%;
  background: #f8faff;
  border-top: 1px solid #65EFBC;
}

.feedback-header {
  text-align: center;
  margin-bottom: 30px;
}

.feedback-header h2 {
  color: #1f2328;
  font-size: 28px;
  margin-bottom: 8px;
}

.feedback-subtitle {
  color: #6b7280;
  font-size: 16px;
}

/* Form Styles */
.feedback-form {
  max-width: 600px;
  margin: 0 auto 40px;
  padding: 30px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(139, 154, 235, 0.1);
}

.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  color: #1f2328;
  font-weight: 500;
}

.form-textarea {
  width: 100%;
  height: 120px;
  padding: 12px 16px;
  border: 1px solid #65EFBC;
  border-radius: 8px;
  font-family: 'Inter', sans-serif;
  font-size: 16px;
  resize: vertical;
  transition: border-color 0.3s;
}

.form-textarea:focus {
  outline: none;
  border-color: #657EEF;
  box-shadow: 0 0 0 2px rgba(139, 154, 235, 0.2);
}

/* Star Rating */
.rating-group {
  display: flex;
  flex-direction: column;
}

.star-rating {
  display: flex;
  flex-direction: row-reverse;
  justify-content: flex-end;
}

.star-rating input {
  display: none;
}

.star-rating label {
  color: #d8dee4;
  font-size: 28px;
  padding: 0 4px;
  cursor: pointer;
  transition: color 0.2s;
}

.star-rating input:checked ~ label,
.star-rating input:hover ~ label,
.star-rating label:hover,
.star-rating label:hover ~ label {
  color: #ffc107;
}

.star-rating input:checked + label {
  color: #ffc107;
}

/* Submit Button */
.submit-btn {
  width: 100%;
  padding: 12px;
  background-color: #657EEF;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s;
}

.submit-btn:hover {
  background-color: #657EEF;
  transform: translateY(-2px);
}

.submit-btn:active {
  transform: translateY(0);
}

/* Feedback Message */
.feedback-message {
  margin-top: 16px;
  text-align: center;
  font-size: 14px;
}

/* Feedback List */
.feedback-list-container {
  max-width: 800px;
  margin: 0 auto;
}

.feedback-list-title {
  color: #1f2328;
  font-size: 20px;
  margin-bottom: 20px;
  padding-bottom: 8px;
  border-bottom: 1px solid #65EFBC;
}

.feedback-list {
  display: grid;
  gap: 16px;
}

/* Feedback Item */
.feedback-item {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.feedback-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.feedback-user {
  font-weight: 600;
  color: #1f2328;
}

.feedback-role {
  font-size: 12px;
  color: #6b7280;
  margin-left: 6px;
}

.feedback-date {
  font-size: 12px;
  color: #6b7280;
}

.feedback-stars {
  color: #ffc107;
  margin: 8px 0;
}

.feedback-content {
  color: #1f2328;
  line-height: 1.5;
}

.feedback-actions {
  margin-top: 12px;
  display: flex;
  gap: 8px;
}

/* Toggle Button */
.toggle-btn {
  display: block;
  margin: 20px auto 0;
  padding: 8px 16px;
  background: #657EEF;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.toggle-btn:hover {
  background: #7a88d1;
}

/* Responsive */
@media (max-width: 768px) {
  .feedback-container {
    padding: 30px 5%;
  }
  
  .feedback-form {
    padding: 20px;
  }
}
</style>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
  const API_BASE = window.location.origin;
  const token = sessionStorage.getItem("token");
  const section = document.getElementById("feedback-section");
  const form = document.getElementById("feedback-form");
  const msgEl = document.getElementById("feedback-message");
  const listEl = document.getElementById("feedback-list");
  let showingAll = false;

  // Hide feedback section if not logged in
  if (!token) {
    section.style.display = "none";
    return;
  }

  // Parse JWT helper function
  function parseJwt(t) {
    try {
      const base64Url = t.split(".")[1];
      const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
      const json = atob(base64);
      return JSON.parse(decodeURIComponent(
        json.split("")
            .map(c => "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2))
            .join("")
      ));
    } catch {
      return null;
    }
  }
  
  const currentUser = parseJwt(token);
  const isLecturer = currentUser?.role === "lecturer";

  // Submit feedback handler
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    msgEl.textContent = "";
    msgEl.className = "feedback-message";

    const comment = document.getElementById("comment").value.trim();
    const rating = document.querySelector("input[name='rating']:checked")?.value;
    
    if (!comment || !rating) {
      msgEl.textContent = "Please provide both feedback and a rating.";
      msgEl.classList.add("error");
      return;
    }

    try {
      const res = await fetch(`${API_BASE}/api/feedback/submit`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ comment, rating })
      });
      
      const data = await res.json();
      
      if (res.ok) {
        msgEl.textContent = "Thank you for your feedback!";
        msgEl.classList.add("success");
        form.reset();
        loadFeedback();
      } else {
        msgEl.textContent = data.message || "Submission failed. Please try again.";
        msgEl.classList.add("error");
      }
    } catch (err) {
      msgEl.textContent = "Network error. Please try again later.";
      msgEl.classList.add("error");
      console.error("Feedback submission error:", err);
    }
  });

  // Delegate edit/delete actions
  listEl.addEventListener("click", async (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;
    
    const id = btn.dataset.id;
    if (!id) return;

    // Delete feedback
    if (btn.classList.contains("delete-btn")) {
      if (!confirm("Are you sure you want to delete this feedback?")) return;
      
      try {
        const res = await fetch(`${API_BASE}/api/feedback/${id}`, {
          method: "DELETE",
          headers: { "Authorization": "Bearer " + token }
        });
        
        if (res.ok) {
          loadFeedback();
        } else {
          const error = await res.json();
          alert(error.message || "Failed to delete feedback");
        }
      } catch (err) {
        console.error("Delete error:", err);
        alert("Network error. Please try again.");
      }
    }
    // Edit feedback
    else if (btn.classList.contains("edit-btn")) {
      const item = btn.closest(".feedback-item");
      const currentComment = item.querySelector(".feedback-content").textContent;
      const currentRating = item.querySelector(".feedback-stars").textContent.length;
      
      const newComment = prompt("Edit your feedback:", currentComment);
      if (newComment === null) return;
      
      const newRating = prompt("Edit your rating (1-5):", currentRating);
      if (newRating === null || !newRating.match(/^[1-5]$/)) {
        alert("Please enter a valid rating between 1 and 5");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/api/feedback/${id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          },
          body: JSON.stringify({ 
            comment: newComment.trim(), 
            rating: parseInt(newRating) 
          })
        });
        
        if (res.ok) {
          loadFeedback();
        } else {
          const error = await res.json();
          alert(error.message || "Failed to update feedback");
        }
      } catch (err) {
        console.error("Update error:", err);
        alert("Network error. Please try again.");
      }
    }
  });

  // Load and render feedback
  async function loadFeedback() {
    listEl.innerHTML = '<div class="loading">Loading feedback...</div>';
    
    try {
      const res = await fetch(`${API_BASE}/api/feedback`, {
        headers: { "Authorization": "Bearer " + token }
      });
      
      if (!res.ok) {
        throw new Error(await res.text());
      }
      
      const payload = await res.json();
      const allFeedback = Array.isArray(payload.feedback) ? payload.feedback : [];
      const feedbackToShow = showingAll ? allFeedback : allFeedback.slice(0, 5);
      
      if (allFeedback.length === 0) {
        listEl.innerHTML = '<div class="no-feedback">No feedback yet. Be the first to share!</div>';
        return;
      }
      
      listEl.innerHTML = feedbackToShow.map(feedback => `
        <div class="feedback-item">
          <div class="feedback-meta">
            <div>
              <span class="feedback-user">${feedback.username || "Anonymous"}</span>
              <span class="feedback-role">(${feedback.role})</span>
            </div>
            <div class="feedback-date">
              ${new Date(feedback.createdAt).toLocaleString()}
            </div>
          </div>
          <div class="feedback-stars">
            ${"★".repeat(feedback.rating)}${"☆".repeat(5 - feedback.rating)}
          </div>
          <div class="feedback-content">
            ${feedback.comment}
          </div>
          ${isLecturer ? `
            <div class="feedback-actions">
              <button data-id="${feedback._id}" class="edit-btn">Edit</button>
              <button data-id="${feedback._id}" class="delete-btn">Delete</button>
            </div>
          ` : ''}
        </div>
      `).join("");
      
      // Add show more/less toggle if needed
      if (allFeedback.length > 5) {
        const toggleBtn = document.createElement("button");
        toggleBtn.className = "toggle-btn";
        toggleBtn.textContent = showingAll ? "Show Less" : "Show All";
        toggleBtn.addEventListener("click", () => {
          showingAll = !showingAll;
          loadFeedback();
        });
        listEl.appendChild(toggleBtn);
      }
    } catch (err) {
      console.error("Error loading feedback:", err);
      listEl.innerHTML = `
        <div class="error-message">
          Failed to load feedback. Please try again later.
        </div>
      `;
    }
  }

  // Initial load
  loadFeedback();
});
  </script>


</body>
</html>