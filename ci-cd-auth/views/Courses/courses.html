<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Courses ‚Äì CI/CD Learning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
    /* ---------- Base Styles ---------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: #FFFFFF;
      color: #1f2328;
      line-height: 1.5;
    }
    
    /* ---------- Header Styles ---------- */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 16px 10%;
      background: #FFFFFF;
      border-bottom: 1px solid #d8dee4;
      display: flex;
      align-items: center;
      z-index: 10;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-img {
      height: 32px;
      width: 32px;
    }
    
    .logo-text {
      font-size: 1.25rem;
      font-weight: 600;
      color: #657EEF;
    }
    
    .nav-links {
      list-style: none;
      display: flex;
      gap: 24px;
      margin-left: auto;
    }
    
    .nav-links a {
      color: #1f2328;
      font-weight: 500;
      font-size: 14px;
      text-decoration: none;
      padding: 8px 0;
      position: relative;
    }
    
    .nav-links a:hover {
      color: #657EEF;
    }
    
    .nav-links .active {
      color: #657EEF;
    }
    
    .nav-links .active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: #657EEF;
    }
    
    main {
      padding: 140px 10% 80px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .page-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .page-header h1 {
      font-size: 36px;
      font-weight: 700;
      color: #657EEF;
      margin-bottom: 16px;
    }
    
    .page-header p {
      font-size: 18px;
      color: #1f2328;
      max-width: 700px;
      margin: 0 auto;
    }

    /* ---------- Search Bar Styles ---------- */
    .search-container {
      max-width: 600px;
      margin: 0 auto 40px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 12px 20px;
      padding-right: 50px;
      border: 1px solid #65EFBC;
      border-radius: 30px;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #657EEF;
      box-shadow: 0 2px 12px rgba(139, 154, 235, 0.2);
    }
      .exam-description {
    max-width: 700px;
    margin: 16px auto 24px;
    font-size: 16px;
    color: #1f2328;
    text-align: center;
    line-height: 1.5;
  }
      /* ‚îÄ‚îÄ‚îÄ Beautiful Exam CTA Button ‚îÄ‚îÄ‚îÄ */
    .exam-cta-button {
      display: inline-block;
      background: linear-gradient(135deg, #657EEF 0%, #4A65E6 100%);
      color: #ffffff;
      padding: 14px 48px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 50px;
      box-shadow: 0 6px 18px rgba(101, 126, 239, 0.3);
      text-decoration: none;
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
    }

    .exam-cta-button:hover {
      background: linear-gradient(135deg, #4A65E6 0%, #657EEF 100%);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 10px 28px rgba(101, 126, 239, 0.4);
    }

    .exam-cta-button:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 0 4px 12px rgba(101, 126, 239, 0.2);
    }


    .search-icon {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: #657EEF;
    }
    
    /* ---------- Upload Form Styles ---------- */
    .upload-container {
      background: #FFFFFF;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 40px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border: 1px solid #FFFFFF;
      max-width: 600px;
      margin: 0 auto 40px;
    }

    .upload-container h2 {
      color: #657EEF;
      margin-bottom: 20px;
      text-align: center;
      font-size: 24px;
    }

    .upload-form-group {
      margin-bottom: 20px;
    }

    .upload-form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #1f2328;
    }

    .upload-form-group input[type="text"],
    .upload-form-group input[type="file"] {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #65EFBC;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .upload-form-group input[type="text"]:focus {
      outline: none;
      border-color: #657EEF;
      box-shadow: 0 0 0 2px rgba(139, 154, 235, 0.2);
    }

    .file-upload-wrapper {
      position: relative;
      margin-bottom: 20px;
    }

    .file-upload-label {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      border: 2px dashed #65EFBC;
      border-radius: 8px;
      background: #FFFFFF;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .file-upload-label:hover {
      border-color: #657EEF;
      background: #FFFFFF;
    }

    .file-upload-icon {
      font-size: 48px;
      color: #657EEF;
      margin-bottom: 16px;
    }

    .file-upload-text {
      text-align: center;
      color: #6b7280;
    }

    .file-upload-text strong {
      color: #657EEF;
    }

    .upload-btn {
      width: 100%;
      padding: 14px;
      background: #657EEF;
      color: #FFFFFF;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .upload-btn:hover {
      background: #7a88d1;
      transform: translateY(-2px);
    }

    .upload-btn:active {
      transform: translateY(0);
    }
    
    /* ---------- Video Card Styles ---------- */
    .video-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      margin-top: 40px;
    }
    
    .video-card {
      background: #FFFFFF;
      border: 1px solid #65EFBC;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,.05);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .video-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 24px rgba(0,0,0,.1);
    }
    
    .video-card video {
      width: 100%;
      border-bottom: 1px solid #FFFFFF;
      border-radius: 12px 12px 0 0;
    }
    
    .video-info {
      padding: 20px;
    }
    
    .video-info h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1f2328;
    }
    
    .video-actions{
  display:flex;
  gap:12px;                 /* distance between the two buttons   */
}
    
    /* ---------- Feedback Styles ---------- */
    .feedback-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px dashed #e2e8f0;
    }
    
    .feedback-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .feedback-header h4 {
      font-size: 16px;
      font-weight: 600;
      color: #1f2328;
    }
    
    .feedback-toggle {
      background: none;
      border: none;
      color: #657EEF;
      cursor: pointer;
      font-size: 14px;
    }
    
    .feedback-form {
      margin-bottom: 15px;
      display: none;
    }
    
    .feedback-form textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      margin-bottom: 10px;
      resize: vertical;
      min-height: 80px;
      font-family: 'Inter', sans-serif;
    }
    
    .rating-container {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
    }
    
    .star-rating {
      display: flex;
      gap: 5px;
    }
    
    .star-rating input {
      display: none;
    }
    
    .star-rating label {
      cursor: pointer;
      font-size: 20px;
      color: #d1d5db;
    }
    
    .star-rating input:checked ~ label {
      color: #fbbf24;
    }
    
    .star-rating label:hover,
    .star-rating label:hover ~ label {
      color: #fbbf24;
    }
    
    .submit-feedback-btn {
      background: #657EEF;
      color: #FFFFFF;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .submit-feedback-btn:hover {
      background: #7a88d1;
    }
    
    .feedback-list {
      max-height: 200px;
      overflow-y: auto;
      margin-top: 10px;
    }
    
    .feedback-item {
      padding: 10px;
      border-bottom: 1px solid #f1f5f9;
      margin-bottom: 10px;
    }
    
    .feedback-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    
    .feedback-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 13px;
    }
    
    .feedback-username {
      font-weight: 600;
      color: #1f2328;
    }
    
    .feedback-date {
      color: #6b7280;
    }
    
    .feedback-rating {
      color: #fbbf24;
      margin-bottom: 5px;
    }
    
    .feedback-comment {
      font-size: 14px;
      color: #1f2328;
      line-height: 1.4;
    }
    
    .btn {
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .delete-btn {
      background: #ff4c4c;
      color: #FFFFFF;
    }
    
    .delete-btn:hover {
      background: #d93636;
      transform: translateY(-1px);
    }
    
    .quiz-btn {
      background: #657EEF;
      color: #FFFFFF;
    }
    
    .quiz-btn:hover {
      background: #7a88d1;
      transform: translateY(-1px);
    }
    
    /* ---------- Quiz Modal ---------- */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 20;
    }
    
    .quiz-modal {
      background: #FFFFFF;
      padding: 30px;
      border-radius: 12px;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 10px 25px rgba(0,0,0,.1);
    }
    
    .quiz-modal h2 {
      color: #657EEF;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .quiz-modal h2::before {
      content: "üìù";
    }
    
    .quiz-question {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px dashed #d8dee4;
    }
    
    .quiz-question:last-child {
      border-bottom: none;
      margin-bottom: 15px;
    }
    
    .quiz-question p {
      font-weight: 500;
      margin-bottom: 12px;
      color: #1f2328;
    }
    
    .quiz-option {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      padding: 8px 12px;
      border-radius: 6px;
      background: #FFFFFF;
      border: 1px solid #65EFBC;
      transition: all 0.2s ease;
    }
    
    .quiz-option:hover {
      border-color: #657EEF;
      background: #FFFFFF;
    }
    
    .quiz-option input[type="radio"] {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid #65EFBC;
      border-radius: 50%;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
    }
    
    .quiz-option input[type="radio"]:checked {
      border-color: #657EEF;
      background: #657EEF;
    }
    
    .quiz-option input[type="radio"]:checked::after {
      content: "";
      position: absolute;
      top: 3px;
      left: 3px;
      width: 8px;
      height: 8px;
      background: #FFFFFF;
      border-radius: 50%;
    }
    
    .quiz-option label {
      flex: 1;
      cursor: pointer;
    }
    
    .submit-quiz-btn {
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      font-weight: 600;
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    .close-modal {
      background: #6b7280;
      color: #FFFFFF;
    }
    
    .close-modal:hover {
      background: #4b5563;
      transform: translateY(-1px);
    }
    
    /* ---------- Quiz Editor Styles ---------- */
    .question-block {
      background: #f8fafc;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      position: relative;
    }
    
    .question-block label {
      display: block;
      font-weight: 500;
      color: #1f2328;
      margin-bottom: 8px;
    }
    
    .question-block textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      min-height: 80px;
      resize: vertical;
      font-family: 'Inter', sans-serif;
    }
    
    .question-block .option-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #fff;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
      margin-bottom: 8px;
    }
    
    .question-block .option-row input[type="text"] {
      flex: 1;
      padding: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      background: #fff;
    }
    
    .remove-option-btn {
      color: #e53e3e;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      padding: 0 5px;
    }
    
    .add-option-btn {
      background: #edf2f7;
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      margin-top: 10px;
    }
     .github-container {
    background: #fff;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 40px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    border: 1px solid #e1e4e8;
  }
  
  .github-btn {
    background: #24292e;
    color: white;
  }
  /* GitHub box = take the whole grid row */
.github-panel{
  grid-column: 1 / -1;   /* span all columns */
  margin-top: 20px;      /* little breathing room above */
}

  .github-btn:hover {
    background: #2c3136;
  }
  
  .repo-list {
    display: grid;
    gap: 20px;
  }
  
  .repo-item {
    padding: 20px;
    border: 1px solid #e1e4e8;
    border-radius: 6px;
  }
  /* Average Rating Styles */
.average-rating {
  font-size: 14px;
  font-weight: 500;
  margin-left: 8px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.rating-stars {
  color: #fbbf24;
  letter-spacing: 1px;
}

.rating-value {
  font-weight: 600;
  color: #1f2328;
}

.no-rating {
  color: #6b7280;
  font-style: italic;
  font-size: 13px;
}

/* Feedback Container Animation */
#feedback-container {
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.average-rating::before {
  content: "‚òÖ";
  color: #fbbf24;
}
  .repo-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
  }
  
  .form-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #d1d5da;
    border-radius: 6px;
    margin-bottom: 15px;
  }
  
    /* ---------- Empty State ---------- */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }
    
    .empty-state p {
      font-size: 18px;
      color: #6b7280;
    }
    
    .save-quiz {
      background: #657EEF;
      color: #FFFFFF;
      padding: 10px 20px;
    }
    
    .save-quiz:hover {
      background: #7a88d1;
      transform: translateY(-1px);
    }
    
    /* ---------- Responsive ---------- */
    @media (max-width: 1024px) {
      .video-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 768px) {
      header {
        padding: 16px 5%;
      }
      
      .nav-links {
        gap: 16px;
      }
      
      main {
        padding: 120px 5% 60px;
      }
      
     .video-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 30px;
  margin-top: 40px;
}
    }

.section-container{
  position:relative;
  margin-bottom:48px;
  padding:24px;
  background:#ffffff;
  border:1px solid #d8dee4;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
  transition:transform .25s, box-shadow .25s;
}

.section-container:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(0,0,0,.08);
}
/* ‚îÄ‚îÄ‚îÄ SECTION NUMBER FIELD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.section-number-group { margin-bottom: 20px; }

/* tidy label */
.section-number-group label {
  font-weight: 500;
  margin-bottom: 6px;
  display: block;
}

/* wrap lets us position the icon */
.section-number-group .input-wrapper {
  position: relative;
}

/* pretty input */
.section-number-group input[type="number"] {
  width: 100%;
  padding: 12px 16px 12px 46px;          /* left-pad for icon */
  font-size: 16px;
  border: 2px solid #65EFBC;             /* mint border */
  border-radius: 10px;
  background: #fff;
  transition: border .25s, box-shadow .25s;
  appearance: textfield;                 /* hide arrows Firefox */
}

/* hide spinners Chrome / Edge / Safari */
.section-number-group input::-webkit-inner-spin-button,
.section-number-group input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* mint border while still empty */
.section-number-group input:required:placeholder-shown {
  border-color: #65EFBC;
}

/* focus glow (valid) */
.section-number-group input:valid:focus {
  border-color: #65EFBC;
  box-shadow: 0 0 0 3px rgba(101,239,188,.35);
  outline: none;
}

/* out-of-range or non-numeric ‚Üí red */
.section-number-group input:out-of-range {
  border-color: #ff6363;
}

/* icon */
.section-number-group .section-icon {
  position: absolute;
  top: 50%;
  left: 16px;
  transform: translateY(-50%);
  width: 18px; height: 18px;
  fill: #65EFBC;
  pointer-events: none;
}

/* hint text */
.section-number-group .hint {
  margin-top: 6px;
  font-size: 12px;
  color: #6b7280;
}

/* heading row (‚ÄúSection 1‚Äù, ‚ÄúSection 2‚Äù‚Ä¶ ) */
.section-header{
  font:700 24px/1.2 'Inter',sans-serif;
  color:#657EEF;
  border-bottom:2px solid #d8dee4;
  padding-bottom:8px;
  margin-bottom:24px;
}

/* grid that holds the video-cards INSIDE each section */
.videos-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);   /* 3-up on desktop */
  gap:30px;
}

/* nice greyed-out / locked effect for students */
.locked-overlay{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.92);
  backdrop-filter:saturate(140%) blur(3px);
  display:flex;
  align-items:center;
  justify-content:center;
  font:500 18px/1.3 'Inter',sans-serif;
  color:#9ca3af;
  text-align:center;
  border-radius:12px;
  z-index:5;
}
/* PDF list empty state */
.empty-pdfs {
  color: #6b7280;
  font-style: italic;
  margin: 10px 0;
}

/* PDF item wrapper */
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   PDF Item Flex Layout & Truncation Fix
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

.pdf-item {
  display: flex;
  align-items: center;
  /* ensure the item stays on one line */
  white-space: nowrap;
}

.pdf-title {
  /* allow to shrink below its intrinsic size */
  flex: 1 1 auto;
  min-width: 0;                /* critical for text-overflow to work */
  overflow: hidden;
  text-overflow: ellipsis;     /* show ‚Äú‚Ä¶‚Äù when it‚Äôs too long */
  white-space: nowrap;
  margin-right: 12px;          /* space before buttons */
}

.pdf-actions {
  /* prevent buttons from shrinking or wrapping */
  flex: 0 0 auto;
  display: flex;
  gap: 8px;
}


/* Download button */
.btn-download {
  background: linear-gradient(135deg, #657EEF, #7A88D1);
  color: #fff;
  text-decoration: none;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
  box-shadow: 0 4px 12px rgba(101, 126, 239, 0.3);
  transition: transform 0.15s ease, box-shadow 0.2s ease;
}
.btn-download:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(101, 126, 239, 0.4);
}
.btn-download:active {
  transform: translateY(0);
  box-shadow: 0 2px 8px rgba(101, 126, 239, 0.2);
}

/* Delete button */
.btn-delete-pdf {
  background: #ff4c4c;
  color: #fff;
  border: none;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
  box-shadow: 0 4px 12px rgba(255, 76, 76, 0.3);
  transition: transform 0.15s ease, box-shadow 0.2s ease;
  cursor: pointer;
}
.btn-delete-pdf:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(255, 76, 76, 0.4);
}
.btn-delete-pdf:active {
  transform: translateY(0);
  box-shadow: 0 2px 8px rgba(255, 76, 76, 0.2);
}

/* ------------------------------------------------
   Responsive tweaks ‚Äì same breakpoints you already
   use elsewhere, keeps everything consistent
   ------------------------------------------------ */
@media (max-width:1024px){
  .videos-grid{ grid-template-columns:repeat(2,1fr); }   /* tablets: 2-up */
}

@media (max-width:768px){
  .videos-grid{ grid-template-columns:1fr; }              /* phones: 1-up  */
}
/* ‚îÄ‚îÄ UNIFY ‚ÄúVideo Title‚Äù & ‚ÄúSection Number‚Äù STYLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.upload-form-group input[type="text"],
.upload-form-group input[type="number"]{
  width:100%;
  padding:12px 16px;
  font-size:16px;
  border:1px solid #65EFBC;          /* green border like title box */
  border-radius:8px;
  background:#ffffff;
  transition:border-color .25s, box-shadow .25s;
  
  /* hide spinner arrows so the field looks identical */
  -moz-appearance:textfield;         /* Firefox  */
          appearance:textfield;      /* Chromium / Safari */
}
.upload-form-group input[type="text"]:focus,
.upload-form-group input[type="number"]:focus{
  outline:none;
  border-color:#657EEF;              /* brand blue focus ring       */
  box-shadow:0 0 0 3px rgba(101,126,239,.25);
}

/* override the browser‚Äôs default red ‚Äò:invalid‚Äô outline */
.upload-form-group input[type="number"]:required:invalid{
  border-color:#65EFBC;              /* keep it green while empty   */
  box-shadow:none;
}

/* remove WebKit arrows (Chrome, Edge, Safari)                */
.upload-form-group input[type="number"]::-webkit-inner-spin-button,
.upload-form-group input[type="number"]::-webkit-outer-spin-button{
  -webkit-appearance:none; margin:0;
}

  </style>
</head>
<body>
  <header>
    <div class="logo-container">
      <svg class="logo-img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.230.957-.266 1.983-.399 3.003-.404 1.020.005 2.047.138 3.006.404 2.291-1.552 3.297-1.230 3.297-1.230.653 1.652.242 2.873.118 3.176.770.840 1.235 1.910 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.430.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.300 24 12c0-6.627-5.373-12-12-12z"/>
      </svg>
      <span class="logo-text">CI/CD</span>
      <ul class="nav-links" id="nav-links"></ul>
    </div>
  </header>

  <main>
    <div class="page-header">
      <h1>Course Videos</h1>
      <p>Browse our collection of CI/CD tutorial videos and enhance your learning experience</p>
    </div>

    <div class="search-container">
      <input type="text" id="searchInput" class="search-input" placeholder="Search videos by title..." />
      <span class="search-icon">üîç</span>
    </div>

    <div id="uploadForm" class="upload-container" style="display: none;">
      <h2>Upload New Video</h2>
      <form action="/api/videos/upload" method="POST" enctype="multipart/form-data">
        <div class="upload-form-group">
          <label for="videoTitle">Video Title</label>
          <input type="text" id="videoTitle" name="title" placeholder="Enter video title" required />
        </div>
        <!-- keep your existing markup -->
<div class="upload-form-group">
  <label for="videoSection">Section Number (1‚Äì4)</label>
  <input type="number"
         id="videoSection"
         name="section"
         placeholder="Enter section # (1‚Äì4)"
         min="1" max="4" required />
</div>

        <div class="upload-form-group">
          <label>Video File</label>
          <div class="file-upload-wrapper">
            <input type="file" id="videoFile" name="video" accept="video/*" required style="display: none;" />
            <label for="videoFile" class="file-upload-label">
              <span class="file-upload-icon">üìÅ</span>
              <span class="file-upload-text">
                <strong>Click to upload</strong> or drag and drop<br />
                MP4, MOV, or AVI (Max 100MB)
              </span>
            </label>
          </div>
        </div>
        <button type="submit" class="upload-btn">Upload Video</button>
      </form>
    </div>

    <div id="sectionsWrapper"></div>
  </main>

  <div class="modal-overlay" id="quizModal">
    <div class="quiz-modal">
      <h2 id="quizTitle">Video Quiz</h2>
      <div id="quizContent"></div>
    </div>
  </div>

  <script>
    const token = sessionStorage.getItem("token");
    const navbar = document.getElementById("nav-links");
    const uploadForm = document.getElementById("uploadForm");
    const searchInput = document.getElementById("searchInput");
    const sectionsWrapper = document.getElementById("sectionsWrapper");
    let user = null;
    let currentVideoId = null;
    let allVideos = [];
    let courseFeedback = {};
    let unlockedSections = new Set();
    let storageKey = null;

    async function init() {
      setupAuth();
      setupSearch();
      await fetchVideos();
      setupPDFUploadForms();
      setupVideoUploadForm(); 
    }

    function setupAuth() {
      if (!token) {
        navbar.innerHTML = `
          <li><a href="/">Home</a></li>
          <li><a href="/signup">Sign Up</a></li>
          <li><a href="/login">Login</a></li>`;
        return;
      }
      user = parseJwt(token);
      updateNavbar();
      if (user.role === "lecturer") {
        uploadForm.style.display = "block";
      }
      const userId = user._id || user.id;
      storageKey = `unlockedSections_${userId}`;
      if (user.role === "student") {
        const saved = localStorage.getItem(storageKey);
        if (saved) {
          try {
            JSON.parse(saved).forEach((n) => unlockedSections.add(n));
          } catch {
            unlockedSections = new Set([1]);
          }
        } else {
          unlockedSections = new Set([1]);
        }
      }
    }

    function parseJwt(token) {
      try {
        return JSON.parse(atob(token.split(".")[1].replace(/-/g, "+").replace(/_/g, "/")));
      } catch {
        return null;
      }
    }

    function updateNavbar() {
      navbar.innerHTML = "";
      if (user.role === "admin") {
        navbar.innerHTML += `<li><a href="/admin-dashboard">Admin Dashboard</a></li>`;
      } else if (user.role === "lecturer") {
        navbar.innerHTML += `
          <li><a href="/">Home</a></li>
          <li><a href="/video/courses" class="active">Courses</a></li>
          <li><a href="/LecturerProfile">Profile</a></li>`;
      } else if (user.role === "student") {
        navbar.innerHTML += `
          <li><a href="/">Home</a></li>
          <li><a href="/video/courses" class="active">Courses</a></li>
          <li><a href="/StudentProfile">Profile</a></li>`;
      }
      navbar.innerHTML += `<li><a href="#" onclick="logout()">Logout</a></li>`;
    }

    function logout() {
      sessionStorage.removeItem("token");
      location.href = "/login";
    }

    function setupSearch() {
      searchInput.addEventListener("input", () => {
        const term = searchInput.value.toLowerCase();
        const filtered = term ? allVideos.filter((v) => v.title.toLowerCase().includes(term)) : allVideos;
        renderSections(filtered);
      });
    }

 /* ==================  FETCH VIDEOS (fixed)  =================== */
async function fetchVideos() {
  if (!token) return;                       // no auth ‚Üí nothing to do
  const commonHeaders = { Authorization: `Bearer ${token}` };

  // preferred ‚Äì works for students and most lecturer builds
  const MAIN_EP      = "/api/videos/all";

  // fallback ‚Äì some back-ends expose a lecturer-scoped route instead
  const LECTURER_EP  = user?.role === "lecturer"
    ? `/api/videos/lecturer/${user._id || user.id}`
    : null;

  let resp;
  try {
    resp = await fetch(MAIN_EP, { headers: commonHeaders });
    // if the main endpoint is missing / forbidden, fall back once
    if (!resp.ok && LECTURER_EP) {
      resp = await fetch(LECTURER_EP, { headers: commonHeaders });
    }
    if (!resp.ok) throw new Error(`status ${resp.status}`);

    /* allow 204 No-Content without exploding */
    allVideos = resp.status === 204 ? [] : await resp.json();
    renderSections(allVideos);
  } catch (err) {
    console.error("Error fetching videos:", err);
    sectionsWrapper.innerHTML =
      '<div class="empty-state"><p>Failed to load videos. Please try again later.</p></div>';
  }
}


function renderSections(videos) {
  sectionsWrapper.innerHTML = "";

  for (let secNum = 1; secNum <= 4; secNum++) {
    /* ---------- section shell ---------- */
    const vids        = videos.filter(v => v.section === secNum);
    const sectionDiv  = document.createElement("div");
    sectionDiv.classList.add("section-container");
    sectionDiv.id     = `section-${secNum}`;

    /* heading */
    const header = document.createElement("div");
    header.classList.add("section-header");
    header.textContent = `Section ${secNum}`;
    sectionDiv.appendChild(header);

    /* lock overlay (students only) */
    const overlay = document.createElement("div");
    overlay.classList.add("locked-overlay");
    overlay.id = `overlay-${secNum}`;
    overlay.textContent = "üîí Section locked. Finish previous section first.";
    sectionDiv.appendChild(overlay);

    if (user.role === "lecturer") overlay.style.display = "none";

    /* videos grid */
    const grid = document.createElement("div");
    grid.classList.add("videos-grid");
    grid.id = `videos-grid-${secNum}`;
    sectionDiv.appendChild(grid);

    if (user.role === "lecturer") grid.style.opacity = "1";

    /* ---------- populate video cards ---------- */
    if (vids.length === 0) {
      const empty = document.createElement("div");
      empty.classList.add("empty-state");
      empty.innerHTML = `<p>No videos uploaded for Section ${secNum} yet.</p>`;
      grid.appendChild(empty);
    } else {
      vids.forEach(video => {
        const card = document.createElement("div");
        card.classList.add("video-card");

        /* PDF upload form ‚Äì lecturers only */
        let pdfFormHtml = "";
        if (user.role === "lecturer") {
          pdfFormHtml = `
            <form class="pdf-upload-form" id="pdf-upload-form-${video._id}" style="margin-top:15px;">
              <input type="hidden" name="courseId" value="${video._id}">
              <div class="upload-form-group" style="margin-bottom:10px;">
                <input type="text" name="title" placeholder="PDF Title" required
                       style="padding:8px 12px;font-size:14px;background:#f9fafb;border:1px solid #e2e8f0;border-radius:6px;">
              </div>
              <div class="upload-form-group" style="margin-bottom:10px;">
                <input type="file" name="pdf" accept=".pdf" required
                       style="font-size:14px;background:#f9fafb;border:1px solid #e2e8f0;border-radius:6px;">
              </div>
              <button type="submit" class="btn quiz-btn" style="padding:6px 12px;font-size:13px;">
                Upload PDF
              </button>
            </form>`;
        }

        /* delete button ‚Äì lecturers only */
        const lecturerDeleteBtn = user.role === "lecturer"
          ? `<button class="btn delete-btn" onclick="deleteVideo('${video._id}')">Delete Video</button>`
          : "";

        const quizBtnLabel = (user.role === "lecturer") ? "Edit Quiz" : "Take Quiz";
        const safeTitle    = video.title.replace(/'/g, "\\'");   // escape single quotes

        card.innerHTML = `
          <video controls data-video-id="${video._id}">
            <source src="/uploads/${video.filename}" type="video/mp4">
            Your browser does not support HTML5 video.
          </video>
          <div class="video-info">
            <h3>${video.title}</h3>

            <div class="pdf-section" id="pdf-section-${video._id}">
              <h4>Course Materials (PDFs)</h4>
              <div class="pdf-list" id="pdf-list-${video._id}"></div>
              ${pdfFormHtml}
            </div>

            <div class="video-actions">
              ${lecturerDeleteBtn}
              <button class="btn quiz-btn"
                      onclick="showQuiz('${video._id}', '${safeTitle}')">
                ${quizBtnLabel}
              </button>
            </div>

            <div class="feedback-section">
              <div class="feedback-header">
                <h4>Feedback <span id="average-rating-${video._id}" class="average-rating"></span></h4>
                <button class="feedback-toggle" onclick="toggleFeedback('${video._id}')">
                  ${(user.role === "student") ? "Add Feedback" : "View Feedback"}
                </button>
              </div>
              ${user.role === "student" ? `
                <div id="feedback-form-${video._id}" class="feedback-form" style="display:none;">
                  <textarea id="feedback-comment-${video._id}" placeholder="Share your thoughts..."></textarea>
                  <div class="rating-container">
                    <div class="star-rating">
                      ${[5,4,3,2,1].map(n => `
                        <input type="radio" id="star${n}-${video._id}" name="rating-${video._id}" value="${n}">
                        <label for="star${n}-${video._id}">‚òÖ</label>`).join("")}
                    </div>
                  </div>
                  <button class="submit-feedback-btn"
                          onclick="submitFeedback('${video._id}', '${safeTitle}')">
                    Submit Feedback
                  </button>
                </div>` : ""}
              <div id="feedback-container-${video._id}" style="display:none;">
                <div id="feedback-list-${video._id}" class="feedback-list"></div>
              </div>
            </div>
          </div>`;

        grid.appendChild(card);
        fetchCourseFeedback(video._id);
        fetchPDFs(video._id);
      });
    }

    /* ---------- GitHub panel in Section 4 ---------- */
    if (secNum === 4) {
      const gh = document.createElement("div");
gh.className = "github-container github-panel";   // ‚Üê extra class

      gh.id        = "githubPanel";
      gh.innerHTML = `
        <h2 style="margin-bottom:20px;">GitHub Integration</h2>

        <!-- connect button (hidden once linked) -->
        <button class="btn github-btn" id="connectGitHubBtn"
                style="margin-bottom:24px;" onclick="connectGitHub()">
          üîó Connect your GitHub
        </button>

        <!-- repo management (shown after linking) -->
        <div id="repoManagement" style="display:none;flex-direction:column;gap:24px;">

          <!-- create-repo row -->
          <div style="display:flex;flex-wrap:wrap;gap:10px;">
            <input class="form-input" id="repoName"        placeholder="Repository name">
            <input class="form-input" id="repoDescription" placeholder="Description (optional)">
            <label style="display:flex;align-items:center;gap:6px;font-size:14px;">
              <input type="checkbox" id="repoPrivate"> Private
            </label>
            <button class="btn github-btn" onclick="createRepo()">Create</button>
          </div>

          <!-- repo list -->
          <div class="repo-list" id="repoList"><p>Loading repositories‚Ä¶</p></div>
        </div>`;
      grid.appendChild(gh);

      /* kick off GitHub status check */
      checkGitHubConnection();
    }

    /* finally add the section to the main wrapper */
    sectionsWrapper.appendChild(sectionDiv);
  }

  /* lock logic (students only) */
  if (user.role === "student") {
    processSectionLocks();
    attachVideoEndListeners();
  } else {
    document.querySelectorAll(".locked-overlay").forEach(o => o.remove());
  }
    if (user.role === "student") {
    const examDiv = document.createElement("div");
    examDiv.className = "section-container";
    examDiv.id        = "section-exam";
    examDiv.innerHTML = `
      <div class="section-header">üéì Final Certification Exam</div>
      <p class="exam-description">
        You‚Äôve completed every module‚Äînow prove your CI/CD mastery and earn your official certificate!
      </p>
      <div class="videos-grid" style="justify-content:center;padding:40px 0;">
      <a href="/exam" class="cta-button exam-cta-button">
             Start Final Exam</a>      </div>
    `;
    sectionsWrapper.appendChild(examDiv);
  }
  
}


    function processSectionLocks() {
      for (let secNum = 1; secNum <= 4; secNum++) {
        const overlayEl = document.getElementById(`overlay-${secNum}`);
        const gridEl = document.getElementById(`videos-grid-${secNum}`);
        if (user.role === "lecturer") {
          overlayEl.style.display = "none";
          gridEl.style.opacity = "1";
          continue;
        }
        if (secNum === 1) {
          unlockedSections.add(1);
          overlayEl.style.display = "none";
          gridEl.style.opacity = "1";
        } else {
          if (unlockedSections.has(secNum)) {
            overlayEl.style.display = "none";
            gridEl.style.opacity = "1";
          } else {
            overlayEl.style.display = "flex";
            gridEl.style.opacity = "0.5";
          }
        }
      }
      if (user.role === "student" && storageKey) {
        localStorage.setItem(storageKey, JSON.stringify(Array.from(unlockedSections)));
      }
    }

    function attachVideoEndListeners() {
      document.querySelectorAll("video[data-video-id]").forEach((v) => {
        v.addEventListener("ended", async () => {
          if (user.role !== "student") return;
          const vidId = v.dataset.videoId;
          await markAsWatched(vidId);
          unlockNextSection(vidId);
        });
      });
    }

    async function markAsWatched(videoId) {
      try {
        await fetch(`/api/progress/watch/${user._id}/${videoId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
        });
      } catch (e) {
        console.error("Error marking video watched:", e);
      }
    }

    function unlockNextSection(videoId) {
      const vid = allVideos.find((v) => v._id === videoId);
      if (!vid) return;
      const currentSection = vid.section;
      const nextSection = currentSection + 1;
      if (nextSection <= 4 && !unlockedSections.has(nextSection)) {
        unlockedSections.add(nextSection);
        document.getElementById(`overlay-${nextSection}`).style.display = "none";
        document.getElementById(`videos-grid-${nextSection}`).style.opacity = "1";
        if (storageKey) {
          localStorage.setItem(storageKey, JSON.stringify(Array.from(unlockedSections)));
        }
      }
    }

    function setupPDFUploadForms() {
      setTimeout(() => {
        document.querySelectorAll(".pdf-upload-form").forEach((form) => {
          form.addEventListener("submit", function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const courseId = formData.get("courseId");
            fetch("/api/pdfs/upload", {
              method: "POST",
              headers: { Authorization: "Bearer " + token },
              body: formData,
            })
              .then((resp) => resp.json())
              .then((data) => {
                if (data.success) {
                  alert("PDF uploaded successfully!");
                  this.reset();
                  fetchPDFs(courseId);
                } else {
                  alert("Failed to upload PDF: " + (data.message || "Unknown error"));
                }
              })
              .catch((err) => {
                console.error("Error uploading PDF:", err);
                alert("Failed to upload PDF. Please try again.");
              });
          });
        });
      }, 500);
    }

    function fetchPDFs(courseId) {
      fetch(`/api/pdfs/course/${courseId}`, {
        headers: { Authorization: "Bearer " + token },
      })
        .then((resp) => resp.json())
        .then((pdfs) => {
          renderPDFs(courseId, pdfs);
        })
        .catch((err) => {
          console.error("Error fetching PDFs:", err);
          document.getElementById(`pdf-list-${courseId}`).innerHTML =
            "<p>Failed to load PDF materials.</p>";
        });
    }

   function renderPDFs(courseId, pdfs) {
  const pdfList = document.getElementById(`pdf-list-${courseId}`);
  if (!pdfs || pdfs.length === 0) {
    pdfList.innerHTML =
      '<p class="empty-pdfs">No PDF materials available for this course.</p>';
    return;
  }
  let html = "";
  pdfs.forEach(pdf => {
    html += `
      <div class="pdf-item">
        <span class="pdf-title">${pdf.title}</span>
        <div class="pdf-actions">
          <a href="/uploads/${pdf.filename}"
             target="_blank"
             class="btn-download">
            Download
          </a>
          ${
            user.role === "lecturer"
              ? `<button class="btn-delete-pdf"
                          onclick="deletePDF('${pdf._id}', '${courseId}')">
                   Delete
                 </button>`
              : ``
          }
        </div>
      </div>
    `;
  });
  pdfList.innerHTML = html;
}


    function deletePDF(pdfId, courseId) {
  if (!confirm("Are you sure you want to delete this PDF?")) return;
  fetch(`/api/pdfs/${pdfId}`, {
    method: "DELETE",
    headers: { Authorization: "Bearer " + token },
  })
    .then(resp => resp.json())
    .then(() => {
      alert("PDF deleted successfully!");
      // re-fetch only this course's PDFs
      fetchPDFs(courseId);
    })
    .catch(() => {
      alert("Failed to delete PDF. Please try again.");
    });
}

    function toggleFeedback(courseId) {
      const feedbackForm = document.getElementById(`feedback-form-${courseId}`);
      const feedbackContainer = document.getElementById(`feedback-container-${courseId}`);
      if (user.role === "student") {
        if (feedbackForm.style.display === "block") {
          feedbackForm.style.display = "none";
          feedbackContainer.style.display = "none";
        } else {
          feedbackForm.style.display = "block";
          fetchCourseFeedback(courseId);
          feedbackContainer.style.display = "block";
        }
      } else {
        if (feedbackContainer.style.display === "block") {
          feedbackContainer.style.display = "none";
        } else {
          fetchCourseFeedback(courseId);
          feedbackContainer.style.display = "block";
        }
      }
    }

    function fetchCourseFeedback(courseId) {
      fetch(`/api/feedback/course/${courseId}`, {
        headers: { Authorization: "Bearer " + token },
      })
        .then((resp) => resp.json())
        .then((data) => {
          courseFeedback[courseId] = data.feedback || [];
          renderFeedback(courseId);
        })
        .catch((err) => {
          console.error("Error fetching feedback:", err);
          const fbList = document.getElementById(`feedback-list-${courseId}`);
          if (fbList) fbList.innerHTML = "<p>Failed to load feedback. Please try again.</p>";
        });
    }

    function renderFeedback(courseId) {
      const feedbackList = document.getElementById(`feedback-list-${courseId}`);
      const averageRatingEl = document.getElementById(`average-rating-${courseId}`);
      const feedback = courseFeedback[courseId] || [];
      if (feedback.length > 0) {
        const totalRating = feedback.reduce((sum, item) => sum + item.rating, 0);
        const avg = totalRating / feedback.length;
        const rounded = Math.round(avg * 10) / 10;
        averageRatingEl.innerHTML =
          '<span class="rating-stars">' +
            '‚òÖ'.repeat(Math.round(avg)) +
            '‚òÜ'.repeat(5 - Math.round(avg)) +
          '</span>' +
          '<span class="rating-value">' + rounded + '</span>';
        averageRatingEl.title = `Average: ${rounded} from ${feedback.length} review${feedback.length > 1 ? 's' : ''}`;
      } else {
        averageRatingEl.innerHTML = '<span class="no-rating">No ratings yet</span>';
        averageRatingEl.title = "No ratings yet";
      }
      const feedbackContainer = document.getElementById(`feedback-container-${courseId}`);
      if (feedbackContainer.style.display === "block") {
        if (feedback.length === 0) {
          feedbackList.innerHTML = "<p>No feedback available for this course yet.</p>";
          return;
        }
        let html = "";
        feedback.forEach((item) => {
          const date = new Date(item.createdAt).toLocaleDateString();
          const stars = "‚òÖ".repeat(item.rating) + "‚òÜ".repeat(5 - item.rating);
          html +=
            '<div class="feedback-item">' +
              '<div class="feedback-meta">' +
                '<span class="feedback-username">' + item.username + '</span>' +
                '<span class="feedback-date">' + date + '</span>' +
              '</div>' +
              '<div class="feedback-rating">' + stars + '</div>' +
              '<div class="feedback-comment">' + item.comment + '</div>' +
            '</div>';
        });
        feedbackList.innerHTML = html;
      }
    }

    function submitFeedback(courseId, courseTitle) {
      const commentEl = document.getElementById(`feedback-comment-${courseId}`);
      const comment = commentEl.value.trim();
      const ratingInputs = document.getElementsByName(`rating-${courseId}`);
      let rating = 0;
      for (let i = 0; i < ratingInputs.length; i++) {
        if (ratingInputs[i].checked) {
          rating = parseInt(ratingInputs[i].value);
          break;
        }
      }
      if (!comment) {
        alert("Please enter a comment.");
        return;
      }
      if (rating === 0) {
        alert("Please select a rating.");
        return;
      }
      fetch("/api/feedback/submit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token,
        },
        body: JSON.stringify({ comment, rating, courseId, courseTitle }),
      })
        .then((resp) => resp.json())
        .then(() => {
          alert("Feedback submitted successfully!");
          commentEl.value = "";
          for (let i = 0; i < ratingInputs.length; i++) {
            ratingInputs[i].checked = false;
          }
          document.getElementById(`feedback-form-${courseId}`).style.display = "none";
          fetchCourseFeedback(courseId);
        })
        .catch((err) => {
          console.error("Error submitting feedback:", err);
          alert("Failed to submit feedback. Please try again.");
        });
    }

    function connectGitHub() {
      window.location.href = "/api/github/login";
    }

    function checkGitHubConnection() {
      fetch("/api/users/me", {
        headers: { Authorization: "Bearer " + token },
      })
        .then((resp) => resp.json())
        .then((me) => {
          if (me.githubUsername) {
            document.getElementById("connectGitHubBtn").style.display = "none";
            document.getElementById("repoManagement").style.display = "flex";
            fetchRepositories();
          }
        });
    }

    function fetchRepositories() {
      fetch("/api/github/repos", {
        headers: { Authorization: "Bearer " + token },
      })
        .then((resp) => resp.json())
        .then((repos) => {
          const repoList = document.getElementById("repoList");
          repoList.innerHTML = "";
          if (!repos.length) {
            repoList.innerHTML = "<p>No repositories found. Create your first one!</p>";
            return;
          }
          repos.forEach((repo) => {
            const div = document.createElement("div");
            div.className = "repo-item";
            div.innerHTML =
              '<h4>' + repo.name + (repo.private ? " üîí" : " üåç") + '</h4>' +
              '<p>' + (repo.description || "No description") + '</p>' +
              '<div class="repo-actions">' +
                '<button class="btn github-btn" onclick="cloneRepo(\'' + repo.name + '\')">Clone</button>' +
                '<a href="' + repo.html_url + '" target="_blank" class="btn github-btn">View on GitHub</a>' +
              '</div>';
            repoList.appendChild(div);
          });
        });
    }

    function createRepo() {
      const name = document.getElementById("repoName").value.trim();
      const description = document.getElementById("repoDescription").value.trim();
      const isPrivate = document.getElementById("repoPrivate").checked;
      if (!name) {
        alert("Please enter a repository name");
        return;
      }
      fetch("/api/github/repos", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token,
        },
        body: JSON.stringify({ name, description, isPrivate }),
      })
        .then((resp) => resp.json())
        .then(() => {
          alert("Repository created successfully!");
          fetchRepositories();
        })
        .catch(() => {
          alert("Failed to create repository");
        });
    }

    function cloneRepo(repoName) {
      fetch("/api/users/me", {
        headers: { Authorization: "Bearer " + token },
      })
        .then((resp) => resp.json())
        .then((me) => {
          alert(
            "To clone this repository, run:\n\n" +
            "git clone https://github.com/" + me.githubUsername + "/" + repoName + ".git"
          );
        });
    }

    function deleteVideo(id) {
      if (!confirm("Are you sure you want to delete this video?")) return;
      fetch(`/api/videos/${id}`, {
        method: "DELETE",
        headers: { Authorization: "Bearer " + token },
      })
        .then((resp) => resp.json())
        .then(() => fetchVideos())
        .catch(() => alert("Failed to delete video. Please try again."));
    }

    function showQuiz(videoId, videoTitle) {
      currentVideoId = videoId;
      const modal = document.getElementById("quizModal");
      const quizTitle = document.getElementById("quizTitle");
      const quizContent = document.getElementById("quizContent");
      quizTitle.textContent = videoTitle + " Quiz";
      quizContent.innerHTML = "";
      modal.style.display = "flex";
      fetch("/api/videos/" + videoId + "/quiz")
        .then((resp) => (resp.ok ? resp.json() : null))
        .then((quiz) => {
          if (!quiz || !quiz.questions || quiz.questions.length === 0) {
            quizContent.innerHTML =
              '<div class="empty-state">' +
                '<p>' +
                  (user.role === "lecturer"
                    ? "No quiz available. Create one below."
                    : "No quiz available for this video yet.") +
                '</p>' +
              '</div>' +
              '<div class="modal-actions">' +
                '<button class="btn close-modal" onclick="closeQuizModal()">Close</button>' +
                (user.role === "lecturer"
                  ? '<button class="btn save-quiz" onclick="renderQuizEditor(quizContent)">Create Quiz</button>'
                  : '') +
              '</div>';
            return;
          }
          if (user.role === "student") {
            renderStudentQuiz(quizContent, quiz);
          } else {
            renderQuizEditor(quizContent, quiz);
          }
        })
        .catch(() => {
          quizContent.innerHTML = "<p>Failed to load quiz. Please try again.</p>";
        });
    }

    function closeQuizModal() {
      document.getElementById("quizModal").style.display = "none";
      currentVideoId = null;
    }

    function renderStudentQuiz(container, quiz) {
      let quizHTML = "";
      quiz.questions.forEach((q, idx) => {
        const qid = q._id || "q" + idx;
        quizHTML +=
          '<div class="quiz-question">' +
            '<p>' + (idx + 1) + ". " + q.prompt + '</p>' +
            q.options.map((opt, i) => {
              return (
                '<div class="quiz-option">' +
                  '<input type="radio" id="q_' + qid + "_" + i + '" name="q_' + qid + '" value="' + i + '">' +
                  '<label for="q_' + qid + "_" + i + '">' + opt.text + '</label>' +
                '</div>'
              );
            }).join("") +
          '</div>';
      });
      quizHTML +=
        '<div class="modal-actions">' +
          '<button class="btn close-modal" onclick="closeQuizModal()">Close</button>' +
          '<button class="btn quiz-btn submit-quiz-btn" id="submitQuizBtn">Submit Quiz</button>' +
        '</div>';
      container.innerHTML = quizHTML;
      document.getElementById("submitQuizBtn").addEventListener("click", submitQuiz);
    }

    function renderQuizEditor(container, quiz = null) {
      container.innerHTML =
        '<div id="quizEditor">' +
          '<div id="questionsContainer"></div>' +
          '<div style="display:flex;justify-content:space-between;margin-top:30px;">' +
            '<button class="btn quiz-btn" onclick="addQuestionBlock()" style="padding:10px 20px;font-size:16px;">' +
              '<span style="font-size:18px;margin-right:8px;">+</span> Add New Question' +
            '</button>' +
            '<div style="display:flex;gap:10px;">' +
              '<button class="btn close-modal" onclick="closeQuizModal()" style="padding:10px 20px;">Cancel</button>' +
              '<button class="btn save-quiz" onclick="saveQuiz()" style="padding:10px 20px;font-weight:600;">Save Quiz</button>' +
            '</div>' +
          '</div>' +
        '</div>';
      const questionsContainer = document.getElementById("questionsContainer");
      if (quiz && quiz.questions) {
        quiz.questions.forEach((q) => addQuestionBlock(q));
      } else {
        addQuestionBlock();
      }
    }

    function addQuestionBlock(question = null) {
      const questionsContainer = document.getElementById("questionsContainer");
      const questionId = question && question._id ? question._id : "q_" + Date.now();

      const questionBlock = document.createElement("div");
      questionBlock.className = "question-block";

      const promptVal = question && question.prompt ? question.prompt : "";
      questionBlock.innerHTML =
        '<div style="margin-bottom:15px;">' +
          '<label>Question Text</label>' +
          '<textarea class="prompt" placeholder="Enter your question here...">' + promptVal + '</textarea>' +
        '</div>' +
        '<div style="margin-bottom:15px;">' +
          '<label>Options (select the correct answer)</label>' +
          '<div id="options-container-' + questionId + '" style="display:grid;gap:10px;"></div>' +
        '</div>';
      const optionsContainer = questionBlock.querySelector("#options-container-" + questionId);

      const opts = question && question.options ? question.options : [
        { text: "", isCorrect: true },
        { text: "", isCorrect: false },
        { text: "", isCorrect: false },
        { text: "", isCorrect: false },
      ];
      opts.forEach((opt, i) => {
        const oDiv = document.createElement("div");
        oDiv.className = "option-row";
        oDiv.innerHTML =
          '<input type="radio" name="correct_' + questionId + '" ' + (opt.isCorrect ? 'checked' : '') +
            ' style="flex-shrink:0;width:18px;height:18px;cursor:pointer;">' +
          '<input type="text" class="opt" placeholder="Option ' + (i + 1) + '" value="' + opt.text + '"' +
            ' style="flex:1;padding:10px;border:1px solid #e2e8f0;border-radius:6px;background:#fff;">' +
          '<button class="remove-option-btn" ' + (opts.length <= 2 ? 'disabled' : '') + '>√ó</button>';
        oDiv.querySelector(".remove-option-btn").addEventListener("click", () => {
          if (optionsContainer.children.length > 2) oDiv.remove();
        });
        optionsContainer.appendChild(oDiv);
      });

      const addOptionBtn = document.createElement("button");
      addOptionBtn.className = "btn add-option-btn";
      addOptionBtn.textContent = "+ Add Option";
      addOptionBtn.addEventListener("click", () => {
        const count = optionsContainer.children.length;
        const oDiv = document.createElement("div");
        oDiv.className = "option-row";
        oDiv.innerHTML =
          '<input type="radio" name="correct_' + questionId + '"' +
            ' style="flex-shrink:0;width:18px;height:18px;cursor:pointer;">' +
          '<input type="text" class="opt" placeholder="Option ' + (count + 1) + '"' +
            ' style="flex:1;padding:10px;border:1px solid #e2e8f0;border-radius:6px;background:#fff;">' +
          '<button class="remove-option-btn">√ó</button>';
        oDiv.querySelector(".remove-option-btn").addEventListener("click", () => {
          if (optionsContainer.children.length > 2) oDiv.remove();
        });
        optionsContainer.appendChild(oDiv);
      });
      optionsContainer.parentNode.insertBefore(addOptionBtn, optionsContainer.nextSibling);

      const removeQBtn = document.createElement("button");
      removeQBtn.className = "btn delete-btn";
      removeQBtn.textContent = "Remove Question";
      removeQBtn.style.position = "absolute";
      removeQBtn.style.top = "15px";
      removeQBtn.style.right = "15px";
      removeQBtn.style.padding = "5px 10px";
      removeQBtn.style.fontSize = "13px";
      removeQBtn.addEventListener("click", () => questionBlock.remove());
      questionBlock.appendChild(removeQBtn);

      questionsContainer.appendChild(questionBlock);
    }

    function saveQuiz() {
      const questionsContainer = document.getElementById("questionsContainer");
      const blocks = Array.from(questionsContainer.querySelectorAll(".question-block"));
      const questions = blocks
        .map((block) => {
          const prompt = block.querySelector(".prompt").value.trim();
          const optEls = Array.from(block.querySelectorAll(".opt"));
          const radEls = Array.from(block.querySelectorAll('input[type="radio"]'));
          const opts = optEls
            .map((inp, idx) => ({
              text: inp.value.trim(),
              isCorrect: radEls[idx].checked,
            }))
            .filter((o) => o.text);
          return { prompt, options: opts };
        })
        .filter((q) => q.prompt && q.options.length >= 2);
      if (!questions.length) {
        alert("Please add at least one valid question with minimum 2 options.");
        return;
      }
      fetch("/api/videos/" + currentVideoId + "/quiz", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token,
        },
        body: JSON.stringify({ questions }),
      })
        .then((resp) => resp.json())
        .then(() => {
          alert("Quiz saved successfully!");
          closeQuizModal();
        })
        .catch((err) => {
          console.error("Error saving quiz:", err);
          alert("Failed to save quiz. Please try again.");
        });
    }

    function submitQuiz() {
      const quizContent = document.getElementById("quizContent");
      const checkedRadios = Array.from(quizContent.querySelectorAll('input[type=radio]:checked'));
      if (!checkedRadios.length) {
        alert("Please answer at least one question.");
        return;
      }
      const answers = checkedRadios.map((radio) => ({
        questionId: radio.name.slice(2),
        optionIndex: parseInt(radio.value),
      }));
      const submitBtn = document.getElementById("submitQuizBtn");
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting...";
      fetch("/api/videos/" + currentVideoId + "/quiz/submit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token,
        },
        body: JSON.stringify({ answers }),
      })
        .then(async (resp) => {
          const result = await resp.json();
          if (!resp.ok) throw new Error(result.message || "Unknown error");
          let msg;
          if (result.score === 100) {
            msg = `üéâ Perfect! You got ${result.score}% ‚Äì All answers correct!`;
          } else if (result.score >= 70) {
            msg = `üëç Good job! You scored ${result.score}%`;
          } else {
            msg = `üìö Keep learning! You scored ${result.score}%`;
          }
          alert(msg);
          closeQuizModal();
        })
        .catch((err) => {
          console.error("Error submitting quiz:", err);
          alert("Failed to submit quiz. Please try again.\n" + err.message);
        })
        .finally(() => {
          submitBtn.disabled = false;
          submitBtn.textContent = "Submit Quiz";
        });
    }

    document.getElementById("videoFile").addEventListener("change", function (e) {
      const fileInput = e.target;
      const fileUploadLabel = document.querySelector(".file-upload-label");
      if (fileInput.files.length > 0) {
        const fileName = fileInput.files[0].name;
        fileUploadLabel.innerHTML =
          '<span class="file-upload-icon">üé•</span>' +
          '<span class="file-upload-text">' +
            '<strong>' + fileName + '</strong><br>' +
            'Ready to upload' +
          '</span>';
      }
    });

    init();
  </script>
</body>
</html>
